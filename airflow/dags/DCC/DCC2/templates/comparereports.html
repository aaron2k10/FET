{% extends "base1.html" %}
{%load static%}


{% block css_files %}
<!--link rel="stylesheet" href= "{% static 'index.css' %}" /-->
<link rel="stylesheet" href= "{% static 'compare.css' %}" />

{% endblock %}

{% block content %}
<body>
<style>
.spinner {
  border: 4px solid rgba(0, 0, 0, 0.1);
  border-left-color: #000;
  border-radius: 50%;
  width: 24px;
  height: 24px;
  animation: spin 1s linear infinite;
  display: none; /* Initially hidden */
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}
</style>
  <div class="row">
    <div class="column11">

<!-- Modal -->

        <div class="card">
            <h3>Compare Details<i class="fa-solid fa-circle-info"></i></h3>
            <form method="POST" action="{% url 'comparereports' %}">
                {% csrf_token %}
                <button class="button1" type="submit">
                    Compare
                     <span class="spinner" role="status" aria-hidden="true"></span>
                </button>
            </form>
            <div class="output">
              {% if filelist %}
                <table class="table">
  <thead>
    <tr>
      <th scope="col">Mainframe Output File Name</th>
        <th scope="col">No.of lines in mainframe</th>
      <th scope="col">Python Output File Name</th>
        <th scope="col">No.of lines in Python</th>
        <th scope="col">Matched/Mismatched</th>
      <th scope="col">Results</th>
    </tr>
  </thead>
  <tbody>
  {% for file in filelist %}
    <tr>
      <td>{{ file.file1 }}</td>
        <td>{{ file.file1length }}</td>
      <td>{{ file.file2 }}</td>
        <td>{{ file.file2length }}</td>
        <td>{{ file.Output }}</td>
       <td><a href="#"  data-bs-toggle="modal" data-bs-target="#exampleModal">
  Mismatches
</a> <input type="hidden" id="custId" name="custId" value={{ file.file2 }}></td>
    </tr>
  {% endfor %}
  </tbody>
</table>
                <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Field Mismatches</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
           <table id="example" class="display" style="color:black" data-my-variable="{{ output_data }}">
                   <thead>
        <tr>
            <th>Line number</th>
            <th>Field name</th>
            <th>Mainframe data</th>
            <th>Python data</th>
        </tr>
    </thead>
               </table>
      </div>
    </div>
  </div>
</div>
              {% else %}
                  <p>No output to display yet.</p>
              {% endif %}
          </div>
        </div>
    </div>
</div>
  <script>
      document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('button[type="submit"]').forEach(function(button) {
            button.addEventListener('click', function() {
                this.querySelector('.spinner').style.display = 'inline-block';
                this.childNodes[0].textContent = 'Comparison in-progress';
            });
        });
    });
  $(document).ready(function() {
    // Event listener for the anchor tag
    $('a[data-bs-toggle="modal"]').on('click', function() {
        const inputValue = $(this).siblings('input[name="custId"]').val();
        console.log(inputValue);

        // Initialize DataTable with the dynamic inputValue
        $('#example').DataTable({
            destroy: true, // Destroy any existing table instance
            processing:true,
            ajax: {
                url: `http://127.0.0.1:8000/test/${inputValue}`,
                dataSrc: ''
            },
            columns: [
                { data: 0 },
                { data: 1 },
                { data: 2 },
                { data: 3 }
            ],
            language: {
                emptyTable: "Files Matched Successfully!!"
            }
        });
    });
});
</script>
</body>
{% endblock %}

{% block js_files %}
<script src="{% static 'js/script.js' %}"></script>
{% endblock %}
